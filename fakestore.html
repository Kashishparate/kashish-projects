<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fakestore</title>
    
    <!-- Bootstrap CSS (CDN + Local Fallback) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" onerror="this.onerror=null;this.href='bootstrap.min.css';">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">

    <style>
        body {
            background-color: #f8f9fa;
        }
        main {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            padding: 15px;
        }
        .card {
            width: 280px;
            transition: transform 0.2s;
        }
        .card:hover {
            transform: scale(1.05);
        }
        .cart-badge {
            font-size: 12px;
            top: -5px;
            right: -5px;
        }
    </style>

    <script type="text/javascript">
        let cartItems = [];

        function LoadCategories() {
            fetch("https://fakestoreapi.com/products/categories")
            .then(response => response.json())
            .then(categories => {
                categories.unshift("all");
                let categoryList = document.getElementById("lstCategories");
                categoryList.innerHTML = "";
                categories.forEach(category => {
                    let option = document.createElement("option");
                    option.text = category.toUpperCase();
                    option.value = category;
                    categoryList.appendChild(option);
                });
            }).catch(error => console.log("Error loading categories:", error));
        }

        function RenderProducts(product) {
            let div = document.createElement("div");
            div.className = "card p-2 shadow-sm";
            div.innerHTML = `
                <img src="${product.image}" class="card-img-top" height="200" alt="Product Image">
                <div class="card-body">
                    <h6 class="card-title text-truncate" title="${product.title}">${product.title}</h6>
                    <p class="text-muted">$${product.price.toFixed(2)}</p>
                    <p class="small">${product.rating.rate} <span class="bi bi-star-fill text-warning"></span> [${product.rating.count}]</p>
                    <button id="${product.id}" onclick="AddToCartClick(${product.id})" class="btn btn-warning w-100 bi bi-cart4"> Add to Cart</button>
                </div>
            `;
            document.querySelector("main").appendChild(div);
        }

        function LoadProducts(url) {
            document.querySelector("main").innerHTML = "<h5 class='text-center'>Loading products...</h5>";
            fetch(url)
            .then(response => response.json())
            .then(products => {
                document.querySelector("main").innerHTML = "";
                products.forEach(RenderProducts);
            }).catch(error => console.log("Error loading products:", error));
        }

        function bodyload() {
            LoadCategories();
            LoadProducts("https://fakestoreapi.com/products");
            UpdateCartCount();
        }

        function CategoryChange() {
            let category = document.getElementById("lstCategories").value;
            let url = category === "all" ? "https://fakestoreapi.com/products" : `https://fakestoreapi.com/products/category/${category}`;
            LoadProducts(url);
        }

        function AddToCartClick(id) {
            fetch(`https://fakestoreapi.com/products/${id}`)
            .then(response => response.json())
            .then(product => {
                cartItems.push(product);
                UpdateCartCount();
                alert(`${product.title} added to cart`);
            }).catch(error => console.log("Error adding to cart:", error));
        }

        function UpdateCartCount() {
            document.getElementById("lblCount").innerText = cartItems.length;
        }

        function CartClick() {
            let total = 0;
            document.querySelector("tbody").innerHTML = "";
            cartItems.forEach(item => {
                total += item.price;
                let tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${item.title}</td>
                    <td><img src="${item.image}" width="50" height="50"></td>
                    <td>$${item.price.toFixed(2)}</td>
                `;
                document.querySelector("tbody").appendChild(tr);
            });
            document.getElementById("lblTotal").innerText = `$${total.toFixed(2)}`;
        }
    </script>
</head>
<body class="container-fluid" onload="bodyload()">
    <header class="d-flex flex-wrap justify-content-between align-items-center p-3 border mt-2 bg-dark text-white">
        <div class="fs-4 fw-bold">Fakestore</div>
        <div class="d-flex">
            <input type="text" id="txtSearch" class="form-control me-2" placeholder="Search Fakestore">
            <button onclick="SearchClick()" class="btn btn-warning bi bi-search"></button>
        </div>
        <button onclick="CartClick()" data-bs-toggle="modal" data-bs-target="#cart" class="btn btn-light bi bi-cart4 position-relative">
            <span class="position-absolute translate-middle badge rounded-pill bg-danger cart-badge" id="lblCount">0</span>
        </button>
    </header>
    <section class="row mt-3">
        <nav class="col-md-3 col-lg-2 p-3 bg-light">
            <label class="fw-bold">Select Category</label>
            <select id="lstCategories" onchange="CategoryChange()" class="form-select"></select>
        </nav>
        <main class="col-md-9 col-lg-10"></main>
    </section>
    <div class="modal fade" id="cart">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="text-primary">Your Cart Items</h3>
                </div>
                <div class="modal-body">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Preview</th>
                                <th>Price</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                        <tfoot>
                            <tr>
                                <td class="fw-bold fs-4 text-success" colspan="2">Total</td>
                                <td class="fw-bold fs-4 text-primary" id="lblTotal">$0.00</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-warning" data-bs-dismiss="modal">OK</button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
